<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Racing Game</title>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
      }
      canvas {
        border: 1px solid black;
        display: block;
        margin: 0 auto;
        width: calc(80vh); /* Выберите нужную ширину */
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <canvas id="gameCanvas"></canvas>
    <script>
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");

      // Определение ширины и высоты canvas
      canvas.width = canvas.clientWidth;
      canvas.height = canvas.clientHeight;

      // Инициализация координат героя и его скорости
      let heroX = canvas.width / 2;
      let heroY = canvas.height - 50;
      const heroWidth = 50;
      const heroHeight = 50;
      let heroSpeed = 5; // Изначальная скорость героя
      const maxHeroSpeed = 20; // Максимальная скорость героя

      // Массив для хранения прямоугольников
      let rectangles = [];

      // Функция создания прямоугольника
      function createRectangle() {
        const rectangleX =
          Math.random() > 0.5
            ? Math.random() * (canvas.width - heroWidth)
            : (Math.random() * canvas.width) / 2;
        const rectangleY = 0;
        const rectangleWidth = heroWidth;
        const rectangleHeight =
          Math.random() * (3 * heroHeight - heroHeight) + heroHeight; // случайная высота от heroHeight до 3 * heroHeight
        const rectangleSpeed = Math.random() * 10 + 1; // случайная скорость от 1 до 10
        const rectangleColor =
          "#" + Math.floor(Math.random() * 16777215).toString(16); // случайный цвет
        return {
          x: rectangleX,
          y: rectangleY,
          width: rectangleWidth,
          height: rectangleHeight,
          speed: rectangleSpeed,
          color: rectangleColor,
        };
      }

      // Функция отрисовки прямоугольника
      function drawRectangle(rectangle) {
        ctx.fillStyle = rectangle.color;
        ctx.fillRect(
          rectangle.x,
          rectangle.y,
          rectangle.width,
          rectangle.height
        );
      }

      // Функция обновления игрового экрана
      function update() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        rectangles.forEach((rectangle) => {
          drawRectangle(rectangle);
          rectangle.y += rectangle.speed; // движение прямоугольника вниз
        });
        drawHero();
        checkCollision(); // Проверка на столкновение героя с прямоугольниками
        requestAnimationFrame(update);
      }

      // Функция отрисовки героя
      function drawHero() {
        ctx.fillStyle = "orange";
        ctx.fillRect(heroX, heroY, heroWidth, heroHeight);
      }

      // Функция проверки на столкновение героя с прямоугольниками
      function checkCollision() {
        rectangles.forEach((rectangle) => {
          if (
            heroX < rectangle.x + rectangle.width &&
            heroX + heroWidth > rectangle.x &&
            heroY < rectangle.y + rectangle.height &&
            heroY + heroHeight > rectangle.y
          ) {
            alert("Game Over!");
            location.reload(); // Перезагрузка страницы при столкновении
          }
        });
      }

      // Обработчик нажатия клавиш
      window.addEventListener("keydown", function (e) {
        switch (e.key) {
          case "ArrowLeft":
            if (heroX - heroSpeed >= 0) {
              heroX -= heroSpeed;
            }
            break;
          case "ArrowRight":
            if (heroX + heroWidth + heroSpeed <= canvas.width) {
              heroX += heroSpeed;
            }
            break;
          case "ArrowUp":
            if (heroY - heroSpeed >= 0) {
              heroY -= heroSpeed;
            }
            break;
          case "ArrowDown":
            if (heroY + heroHeight + heroSpeed <= canvas.height) {
              heroY += heroSpeed;
            }
            break;
          case " ":
            // Увеличиваем скорость героя
            if (heroSpeed < maxHeroSpeed) {
              heroSpeed += 1;
            }
            break;
        }
      });

      // Функция создания и добавления нового прямоугольника в массив
      function addRectangle() {
        rectangles.push(createRectangle());
      }

      // Инициализация игры
      function init() {
        addRectangle(); // Добавляем первый прямоугольник
        setInterval(addRectangle, 2000); // Добавляем новый прямоугольник каждые 2 секунды
        update(); // Запускаем обновление экрана
      }

      // Запуск игры
      init();
    </script>
  </body>
</html>
